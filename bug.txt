Решение в лоб имеет экспотенциальное время выполнения.
Наглядно (для грамматики input.txt): a(b(c(d(e(f(g(1)))))))